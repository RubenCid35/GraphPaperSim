@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#>.
@prefix ql: <http://semweb.mmlab.be/ns/ql#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix onto: <http://upm.ontology.es/papers#>.
@base <https://papers.knowledgegraph.org/v1/>.

<#PaperObject> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/papers_info.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[*]"
	];

	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/paper/{id}";
	    rr:class onto:Paper
	];

	rr:predicateObjectMap [
	    rr:predicate onto:hasLanguage;
	    rr:objectMap [
	        rml:reference "language"
	    ]
	];

	rr:predicateObjectMap [
	    rr:predicate onto:hasDOI;
	    rr:objectMap [
	        rml:reference "doi";
            rr:datatype xsd:anyURI;
	    ]
	];

	rr:predicateObjectMap [
	    rr:predicate onto:hasPublicationDate;
	    rr:objectMap [
	        rml:reference "publication_date";
             rr:datatype xsd:date;
	    ]
	];

	rr:predicateObjectMap [
	    rr:predicate onto:hasSimilarity;
        rr:objectMap [
            rr:parentTriplesMap <#SimilarityPaper>;
            rr:joinCondition [
                rr:child "id";
                rr:parent "from"
            ]
        ]
	];

	rr:predicateObjectMap [
	    rr:predicate onto:hasTitle;
	    rr:objectMap [
	        rml:reference "title"
	    ]
	];
    rr:predicateObjectMap [
        rr:predicate onto:hasAuthor;
        rr:objectMap [
            rr:parentTriplesMap <#InstitutionDirect>;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]
        ];
    ];

    rr:predicateObjectMap [
        rr:predicate onto:hasAuthor;
        rr:objectMap [
            rr:parentTriplesMap <#AuthorDirect>;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]
        ];
    ];

    rr:predicateObjectMap [
        rr:predicate onto:hasTopic;
        rr:objectMap [
            rr:parentTriplesMap <#TopicAssigmentMap>;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]
        ];
    ].

<#AuthorDirect> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/papers_info.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[?(@.authors[0])]"
	];

    rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/author/{authors.[*]}";
    ].

<#InstitutionDirect> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/papers_info.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[?(@.institutions[0])]";
	];

    rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/institutions/{institutions.[*]}";
    ].

<#SimilarityPaper> a rr:TriplesMap;
    rml:logicalSource [
        rml:source "./results/similarity_results.json";
        rml:referenceFormulation ql:JSONPath;
        rml:iterator "$.*"
    ];

	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/similarity/{from}-{to}";
	    rr:class onto:SimilarityPaper
	];

    rr:predicateObjectMap [
        rr:predicate onto:score;
        rr:objectMap [
            rml:reference "similarity";
            rr:datatype xsd:float
        ]
    ];
    rr:predicateObjectMap [
        rr:predicate onto:isSimilarTo;
        rr:objectMap [
            rr:template "https://papers.knowledgegraph.org/v1/paper/{to}";
            rr:datatype xsd:URI
        ]
    ].

<#TopicAssigmentMap> a rr:TriplesMap;
    rml:logicalSource [
        rml:source "./results/topics_prob.json";
        rml:referenceFormulation ql:JSONPath;
        rml:iterator "$.*"
    ];

	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/topic-assig/{id}-{topic_id}";
	    rr:class onto:TopicAssign
	];

    rr:predicateObjectMap [
        rr:predicate onto:assign;
        rr:objectMap [
            rr:parentTriplesMap <#Topic>;
            rr:joinCondition [
                rr:child "topic_id";
                rr:parent "id";
            ]
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate onto:score;
        rr:objectMap [
            rml:reference "topic_prob";
            rr:datatype xsd:float
        ]
    ].


<#Topic> a rr:TriplesMap;
    rml:logicalSource [
        rml:source "./results/topics.json";
        rml:referenceFormulation ql:JSONPath;
        rml:iterator "$.[*]"
    ];
	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/topic/{id}";
	    rr:class onto:Topic
	];

    rr:predicateObjectMap [
        rr:predicate onto:hasWords;
        rr:objectMap [
            rml:reference "words";
            rr:datatype xsd:string;
        ]
    ].

<#Author>
    rml:logicalSource [
        rml:source "./results/authors_info.json";
        rml:referenceFormulation ql:JSONPath;
        rml:iterator "$.[*]"
    ];
	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/author/{id}";
	    rr:class onto:Person
	];
    rr:predicateObjectMap [
        rr:predicate onto:isMemberOf;
        rr:objectMap [
            rr:parentTriplesMap <#AuthorInstitution>;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate onto:hasName;
        rr:objectMap [
            rml:reference "name";
        ]
    ].

<#AuthorInstitution> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/authors_info.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[?(@.institutions[0])]";
	];

    rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/institutions/{institutions.[*]}";
    ].

<#Institution>
    rml:logicalSource [
        rml:source "./results/institutions_info.json";
        rml:referenceFormulation ql:JSONPath;
        rml:iterator "$.[*]"
    ];
	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/institutions/{id}";
	    rr:class onto:Organization
	];

    rr:predicateObjectMap [
        rr:predicate onto:hasName;
        rr:objectMap [
            rml:reference "name";
        ]
    ].


<#Acknowledgements> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/acknowledgment.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[*]"
	];

	rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/paper/{ID}";
	];

    rr:predicateObjectMap [
        rr:predicate onto:acknowledge;
        rr:objectMap [
            rr:parentTriplesMap <#InstitutionAcknowledgement>;
            rr:joinCondition [
                rr:child "ID";
                rr:parent "ID";
            ]
        ];
    ];

    rr:predicateObjectMap [
        rr:predicate onto:acknowledge;
        rr:objectMap [
            rr:parentTriplesMap <#AuthorAcknowledgement>;
            rr:joinCondition [
                rr:child "ID";
                rr:parent "ID";
            ]
        ];
    ].

<#AuthorAcknowledgement> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/acknowledgment.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[?(@.PER[0])]"
	];

    rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/author/{PER.[*]}";
    ].

<#InstitutionAcknowledgement> a rr:TriplesMap;
	rml:logicalSource [
	    rml:source "./results/acknowledgment.json";
	    rml:referenceFormulation ql:JSONPath;
	    rml:iterator "$.[?(@.ORG[0])]";
	];

    rr:subjectMap [
	    rr:template "https://papers.knowledgegraph.org/v1/institutions/{ORG.[*]}";
    ].
